<!DOCTYPE html>
<html lang="pt_BR"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}"
      th:with="titulo='Lista de processos para distribuir'">

  <body>
    <section layout:fragment="content" class="py-4">
      <div class="container-fluid">

        <!-- Header -->
        <div class="d-flex flex-wrap align-items-center justify-content-between mb-3">
          <div>
            <h1 class="h3 mb-1">Processos</h1>
            <p class="text-dark mb-0 small">
              Visualize, filtre e distribua processos como coordenador.
            </p>
          </div>
        </div>

        <!-- Filtros -->
        <div class="cards-form card border-0 shadow mb-4">
          <div class="card-body">

            <div class="d-flex align-items-center mb-3">
              <div class="me-2 d-flex align-items-center justify-content-center rounded-circle bg-light border"
                   style="width: 32px; height: 32px">
                <i class="bi bi-funnel text-secondary"></i>
              </div>
              <div>
                <h2 class="text-secondary h6 mb-0">Filtros</h2>
                <small class="text-muted">Refine a busca por status, aluno e relator.</small>
              </div>
            </div>

            <form th:action="@{/coordenadores}" method="get" class="row g-3 align-items-end">

              <div class="col-md-3">
                <label for="status" class="form-label small text-uppercase text-dark">Status</label>
                <select id="status" name="status" class="form-select">
                  <option value="">Todos</option>
                  <option th:each="s : ${statusItens}"
                          th:value="${s.name()}"
                          th:text="${s.name()}"
                          th:selected="${s.name() == statusSelecionado}">
                  </option>
                </select>
              </div>

              <div class="col-md-3">
                <label for="alunoInteressadoId" class="form-label small text-uppercase text-dark">Aluno</label>
                <select id="alunoInteressadoId" name="alunoInteressadoId" class="form-select">
                  <option value="">Todos</option>
                  <option th:each="aluno : ${alunosItens}"
                          th:value="${aluno.id}"
                          th:text="${aluno.nome}"
                          th:selected="${aluno.id == alunoSelecionado}">
                  </option>
                </select>
              </div>

              <div class="col-md-3">
                <label for="relatorId" class="form-label small text-uppercase text-dark">Relator</label>
                <select id="relatorId" name="relatorId" class="form-select">
                  <option value="">Todos</option>
                  <option th:each="prof : ${professoresItens}"
                          th:value="${prof.id}"
                          th:text="${prof.nome}"
                          th:selected="${prof.id == professorSelecionado}">
                  </option>
                </select>
              </div>

              <div class="col-md-3 d-flex gap-2 justify-content-md-end">
                <button type="submit"
                        class="btn btn-outline-primary"
                        style="
                          color: #0d6efd;
                          border-color: #0d6efd;
                          --bs-btn-hover-color: #0d6efd;
                          --bs-btn-hover-bg: rgba(13, 110, 253, 0.08);
                          --bs-btn-hover-border-color: #0d6efd;">
                  <i class="bi bi-search me-1"></i> Filtrar
                </button>

                <a th:href="@{/coordenadores}" class="btn btn-light border">
                  Limpar
                </a>
              </div>

            </form>
          </div>
        </div>

        <!-- Tabela -->
        <div class="card border-0 shadow-sm">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">

                <thead class="table-light">
                  <tr>
                    <th class="text-nowrap">Número</th>
                    <th class="text-nowrap">Data de Criação</th>
                    <th class="text-nowrap">Aluno interessado</th>
                    <th class="text-nowrap">Status</th>
                    <th class="text-nowrap">Professor Relator</th>
                    <th class="text-end text-nowrap">Ações</th>
                  </tr>
                </thead>

                <tbody>
                  <tr th:each="p : ${processos.content}">
                    <td class="fw-semibold text-primary" th:text="${p.numero}">--</td>

                    <td th:text="${#temporals.format(p.dataCriacao, 'dd/MM/yyyy')}">
                      --/--/----
                    </td>

                    <td th:text="${p.alunoInteressado != null ? p.alunoInteressado.nome : '—'}">
                      —
                    </td>

                    <td>
                      <span class="badge rounded-pill"
                            th:text="${p.status}"
                            th:classappend="${p.status.name() == 'CRIADO' ? ' bg-secondary-subtle text-secondary'
                            : p.status.name() == 'DISTRIBUIDO' ? ' bg-primary-subtle text-primary'
                            : p.status.name() == 'DISPONIVEL' ? ' bg-success-subtle text-success'
                            : p.status.name() == 'EM_PAUTA' ? ' bg-warning-subtle text-warning'
                            : p.status.name() == 'JULGADO' ? ' bg-dark-subtle text-dark'
                            : ' bg-secondary-subtle text-secondary'}">
                        --
                      </span>
                    </td>

                    <td th:text="${p.relator != null ? p.relator.nome : '—'}">—</td>

                    <td class="text-end">
                      <a th:if="${p.status.name() == 'CRIADO'}"
                        th:href="@{/coordenadores/distribuir/{id}(id=${p.id})}"
                        class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-person-check me-1"></i> Distribuir
                      </a>

                      <!-- Mostra '-' quando a ação não está disponível -->
                      <span th:if="${p.status.name() != 'CRIADO'}" class="text-muted">-</span>
                    </td>
                  </tr>

                  <tr th:if="${processos == null or processos.totalElements == 0}">
                    <td colspan="6" class="text-center py-4">
                      Nenhum processo encontrado com os filtros atuais.
                    </td>
                  </tr>
                </tbody>

              </table>
            </div>
          </div>
        </div>

        <!-- Paginação -->
        <div class="d-flex justify-content-between align-items-center mt-3">
          <div class="small text-muted">Total: <span th:text="${processos.totalElements}">0</span></div>
          <div>
            <nav>
              <ul class="pagination mb-0">
                <li class="page-item" th:classappend="${processos.first} ? ' disabled'">
                  <a class="page-link" th:href="@{/coordenadores(page=${processos.number-1}, size=${processos.size}, status=${statusSelecionado}, alunoInteressadoId=${alunoSelecionado}, relatorId=${professorSelecionado})}">Anterior</a>
                </li>
                <li class="page-item disabled">
                  <span class="page-link">Página <span th:text="${processos.number + 1}">1</span> de <span th:text="${processos.totalPages}">1</span></span>
                </li>
                <li class="page-item" th:classappend="${processos.last} ? ' disabled'">
                  <a class="page-link" th:href="@{/coordenadores(page=${processos.number+1}, size=${processos.size}, status=${statusSelecionado}, alunoInteressadoId=${alunoSelecionado}, relatorId=${professorSelecionado})}">Próximo</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>

      </div>
    </section>
  </body>
</html>
