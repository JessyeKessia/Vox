<!DOCTYPE html>
<html lang="pt_BR"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}"
      th:with="titulo='Procesoss distribuidos'">
  <body>
    <section layout:fragment="content" class="py-4">
      <div class="container-fluid">

        <div class="d-flex flex-wrap align-items-center justify-content-between mb-3">
          <div>
            <h1 class="h3 mb-1">Processos Designados</h1>
            <p class="text-dark mb-0 small">Processos que foram atribuídos a você.</p>
          </div>
        </div>

        <div class="card border-0 shadow-sm">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th>Assunto</th>
                    <th>Status</th>
                    <th>Autor</th>
                    <th>Data de criação</th>
                    <th>Data de atribuição</th>
                    <th>Descrição</th>
                    <th>Decisão</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody>
                  <tr th:each="processo : ${processos.content}">
                    <td th:text="${processo.assunto != null ? processo.assunto.nome : '—'}">—</td>

                    <td>
                      <span class="badge rounded-pill"
                            th:text="${processo.status}"
                            th:classappend="${processo.status.name() == 'CRIADO' ? ' bg-secondary-subtle text-secondary'
                              : processo.status.name() == 'DISTRIBUIDO' ? ' bg-primary-subtle text-primary'
                              : processo.status.name() == 'DISPONIVEL' ? ' bg-success-subtle text-success'
                              : processo.status.name() == 'EM_PAUTA' ? ' bg-warning-subtle text-warning'
                              : processo.status.name() == 'JULGADO' ? ' bg-dark-subtle text-dark'
                              : ' bg-secondary-subtle text-secondary'}">
                        --
                      </span>
                    </td>

                    <td th:text="${processo.alunoInteressado != null ? processo.alunoInteressado.nome : '—'}">—</td>

                    <td th:text="${processo.dataCriacao != null ? #temporals.format(processo.dataCriacao, 'dd/MM/yyyy') : '—'}">--/--/----</td>

                    <td th:text="${processo.dataDistribuicao != null ? #temporals.format(processo.dataDistribuicao, 'dd/MM/yyyy') : '—'}">--/--/----</td>

                    <td class="text-truncate" style="max-width: 360px" th:text="${processo.descricao}">—</td>

                    <td>
                      <span th:if="${processo.decisaoRelator == null}" class="badge bg-secondary">Pendente</span>
                      <span th:if="${processo.decisaoRelator != null and processo.decisaoRelator.name() == 'DEFERIDO'}" class="badge bg-success">Deferido</span>
                      <span th:if="${processo.decisaoRelator != null and processo.decisaoRelator.name() == 'INDEFERIDO'}" class="badge bg-danger">Indeferido</span>
                    </td>

                    <td>
                      <a th:if="${processo.status.name() == 'DISTRIBUIDO'}"
                        th:href="@{/professores/decisao/form/{id}(id=${processo.id})}"
                        class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-person-check me-1"></i> Avaliar
                      </a> 

                      <!-- Mostra '-' quando a ação não está disponível -->
                      <span th:if="${processo.status.name() != 'DISTRIBUIDO'}" class="text-muted">-</span>
                    </td>
                  </tr>

                  <tr th:if="${processos == null or processos.totalElements == 0}">
                    <td colspan="8" class="text-center py-4">Nenhum processo encontrado.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <!-- Paginação -->
        <div class="d-flex justify-content-between align-items-center mt-3">
          <div>
            <nav>
              <ul class="pagination mb-0">
                <li th:classappend="${processos.hasPrevious()} ? '' : 'disabled'" class="page-item">
                  <a th:href="@{/professores(page=${processos.number - 1},size=${processos.size})}" class="page-link">Anterior</a>
                </li>
                <li class="page-item disabled">
                  <span class="page-link">Página <span th:text="${processos.number + 1}"></span> de <span th:text="${processos.totalPages}"></span></span>
                </li>
                <li th:classappend="${processos.hasNext()} ? '' : 'disabled'" class="page-item">
                  <a th:href="@{/professores(page=${processos.number + 1},size=${processos.size})}" class="page-link">Próximo</a>
                </li>
              </ul>
            </nav>
          </div>
          <div class="text-muted small">Total: <span th:text="${processos.totalElements}"></span></div>
        </div>

      </div>
    </section>
  </body>
</html>